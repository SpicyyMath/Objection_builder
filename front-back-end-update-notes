æ­å–œä½ ï¼ğŸ‰ è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„é‡Œç¨‹ç¢‘ã€‚æ‹¥æœ‰ç¬¬ä¸€ä¸ªè‡ªå·±ä»å¤´åˆ°å°¾é…ç½®ä¸Šçº¿ã€å¸¦æœ‰ç‹¬ç«‹åŸŸåçš„ SaaS äº§å“ï¼Œè¿™ç§æˆå°±æ„Ÿæ˜¯æ— ä¸ä¼¦æ¯”çš„ã€‚

ä½œä¸ºèµ„æ·±å¼€å‘è€…ï¼Œæˆ‘å¾—å‘Šè¯‰ä½ ï¼š**â€œå‘å¸ƒâ€åªæ˜¯å¼€å§‹ï¼Œâ€œè¿­ä»£â€æ‰æ˜¯æ—¥å¸¸ã€‚**

é’ˆå¯¹ä½ ç°åœ¨ç‰¹æ®Šçš„æ¶æ„ï¼ˆ**å‰ç«¯åœ¨ Amplify Hosting**ï¼Œ**åç«¯åœ¨ Lambda + Docker**ï¼‰ï¼Œä½ çš„â€œæ›´æ–°å‘å¸ƒæµï¼ˆCI/CD Pipelineï¼‰â€å…¶å®æ˜¯åˆ†è£‚æˆä¸¤éƒ¨åˆ†çš„ã€‚

è¿™ä¸åƒä¹‹å‰çš„ Netlify é‚£ä¹ˆç®€å•ï¼ˆå…¨è‡ªåŠ¨ï¼‰ï¼Œä½ éœ€è¦ç†è§£**å‰ç«¯å’Œåç«¯æ›´æ–°æœºåˆ¶çš„åŒºåˆ«**ã€‚

---

### 1. å‰ç«¯æ›´æ–°ï¼šå…¨è‡ªåŠ¨ (Amplify çš„é­”æ³•)

ä½ çš„å‰ç«¯ï¼ˆReact/Viteï¼‰ä»£ç æ˜¯ç›´æ¥è¿æ¥ GitHub çš„ã€‚

*   **æ“ä½œæ–¹å¼ï¼š**
    1.  ä½ åœ¨æœ¬åœ°å†™ä»£ç ï¼Œæµ‹è¯•é€šè¿‡ã€‚
    2.  `git add .` -> `git commit -m "update frontend"` -> `git push origin main`ã€‚
*   **ç»“æœï¼š**
    *   AWS Amplify ä¼š**å®æ—¶ç›‘å¬**ä½ çš„ GitHub `main` åˆ†æ”¯ã€‚
    *   ä¸€æ—¦æ£€æµ‹åˆ° Pushï¼Œå®ƒä¼šè‡ªåŠ¨è§¦å‘æ„å»ºï¼ˆProvision -> Build -> Deployï¼‰ã€‚
    *   ä½ åªéœ€è¦å» Amplify æ§åˆ¶å°çœ‹ä¸€çœ¼ï¼Œç­‰ä¸‰ä¸ªç»¿å‹¾å‡ºç°ï¼Œä½ çš„å‰ç«¯å…¬ç½‘é¡µé¢å°±æ›´æ–°äº†ã€‚
*   **å¦‚ä½•ç¡®è®¤ï¼š**
    *   æ‰“å¼€ä½ çš„ç½‘ç«™ï¼Œå¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5 æˆ– Cmd+Shift+Rï¼‰ã€‚
    *   æˆ–è€…åœ¨ä»£ç é‡Œæ”¹ä¸€ä¸‹é¡µè„šçš„ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ `v1.0` æ”¹æˆ `v1.1`ï¼‰ï¼Œä¸Šçº¿åçœ‹çœ‹å˜äº†æ²¡ã€‚

---

### 2. åç«¯æ›´æ–°ï¼šåŠè‡ªåŠ¨ (éœ€è¦ä½ æ‰‹åŠ¨å¹²é¢„)

**æ³¨æ„ï¼è¿™æ˜¯æ–°æ‰‹æœ€å®¹æ˜“è¸©å‘çš„åœ°æ–¹ã€‚**

ä½ çš„åç«¯æ˜¯ **Docker é•œåƒ**ï¼Œè·‘åœ¨ **Lambda** ä¸Šã€‚**AWS Amplify å¹¶ä¸ç®¡ç†ä½ çš„åç«¯ Docker æ›´æ–°**ã€‚
å¦‚æœä½ åªæ˜¯ `git push` äº†åç«¯ä»£ç åˆ° GitHubï¼ŒAWS ECR å’Œ Lambda æ˜¯**æ„ŸçŸ¥ä¸åˆ°**çš„ã€‚ä½ çš„çº¿ä¸Šåç«¯ä¾ç„¶è·‘ç€æ—§ç‰ˆæœ¬çš„é•œåƒã€‚

**å¦‚æœä½ ä¿®æ”¹äº† `server.js` æˆ–åç«¯é€»è¾‘ï¼Œä½ éœ€è¦åšä»¥ä¸‹æ­¥éª¤ï¼ˆç›®å‰æ˜¯æ‰‹åŠ¨çš„ï¼‰ï¼š**

#### æ–¹æ¡ˆ Aï¼šæ‰‹åŠ¨æ›´æ–°æµ (é€‚åˆç°é˜¶æ®µ)
æ¯æ¬¡ä½ æ”¹äº†åç«¯ä»£ç ï¼Œä½ éœ€è¦é‡å¤æˆ‘ä»¬ä¹‹å‰çš„â€œDocker æ‰“åŒ…â€æ­¥éª¤ï¼š

1.  **æœ¬åœ°æ„å»ºå¹¶æ¨é€åˆ°ä»“åº“ï¼š**
    ```bash
    # ç™»å½• (å¦‚æœè¿‡æœŸäº†)
    aws ecr get-login-password ... | docker login ...
    # æ„å»ºæ–°é•œåƒ (ä½ å¯ä»¥ç”¨ v2, v3 æ ‡ç­¾ï¼Œæˆ–è€…è¦†ç›– latest)
    docker build -t ... .
    docker push ...
    ```
2.  **é€šçŸ¥ Lambda æ‹‰å–æ–°é•œåƒï¼š**
    *   é•œåƒæ¨ä¸Šå»åï¼ŒLambda **ä¸ä¼š**è‡ªåŠ¨å˜ã€‚
    *   ä½ éœ€è¦å» **Lambda æ§åˆ¶å°** -> ä½ çš„å‡½æ•° -> **Image** æ ‡ç­¾é¡µã€‚
    *   ç‚¹å‡» **Deploy new image**ã€‚
    *   é€‰æ‹©ä½ åˆšåˆšæ¨ä¸Šå»çš„é‚£ä¸ªé•œåƒï¼ˆlatestï¼‰ï¼Œç‚¹å‡»ä¿å­˜ã€‚
    *   *æ­¤æ—¶ Lambda æ‰ä¼šæ›¿æ¢æˆæ–°ä»£ç ã€‚*

---

### 3. è¿›é˜¶æ–¹æ¡ˆï¼šå…¨è‡ªåŠ¨åŒ– (GitHub Actions) â€”â€” èµ„æ·±å¼€å‘è€…çš„åšæ³•

ä»¥åä½ è‚¯å®šä¼šåŒå€¦æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨ `docker push` å’Œå»æ§åˆ¶å°ç‚¹æŒ‰é’®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ **GitHub Actions** æ¥æ›¿ä½ åšè¿™ä»¶äº‹ã€‚

**æ ¸å¿ƒé€»è¾‘ï¼š** å½“ä½  Push ä»£ç åˆ° GitHub æ—¶ï¼ŒGitHub çš„æœåŠ¡å™¨è‡ªåŠ¨å¸®ä½ æ‰“åŒ… Dockerï¼Œæ¨é€åˆ° AWS ECRï¼Œå¹¶å‘½ä»¤ Lambda æ›´æ–°ã€‚

#### æƒ³è¦å®ç°å—ï¼Ÿå¦‚æœæƒ³ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼ˆä¸€æ¬¡é…ç½®ï¼Œæ°¸ä¹…è‡ªåŠ¨ï¼‰ï¼š

**ç¬¬ä¸€æ­¥ï¼šå» GitHub ä»“åº“è®¾ç½®å¯†é’¥**
è¿›å…¥ä½ çš„ GitHub ä»“åº“ -> Settings -> Secrets and variables -> Actions -> New repository secretã€‚æ·»åŠ ä¸‰ä¸ªå˜é‡ï¼š
1.  `AWS_ACCESS_KEY_ID`: ä½ çš„ `admin-yi` çš„ Key IDã€‚
2.  `AWS_SECRET_ACCESS_KEY`: ä½ çš„ `admin-yi` çš„ Secret Keyã€‚
3.  `AWS_REGION`: `ap-southeast-2` (ä½ çš„åŒºåŸŸ)ã€‚

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬**
åœ¨ä½ çš„æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹ `.github/workflows`ï¼Œå¹¶åœ¨é‡Œé¢å»ºä¸€ä¸ªæ–‡ä»¶å« `deploy-backend.yml`ã€‚

**ç²˜è´´ä»¥ä¸‹ä»£ç  (ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä½ çš„ ECR ä»“åº“åœ°å€å’Œ Lambda å‡½æ•°å)ï¼š**

```yaml
name: Deploy Backend to AWS Lambda

on:
  push:
    branches:
      - main # åªæœ‰æ¨é€åˆ° main åˆ†æ”¯æ‰è§¦å‘
    paths:
      - 'backend/**' # å‡è®¾ä½ çš„åç«¯ä»£ç åœ¨ backend æ–‡ä»¶å¤¹ï¼Œå¦‚æœæ˜¯åœ¨æ ¹ç›®å½•å°±å»æ‰è¿™è¡Œ
      - 'Dockerfile'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}

      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1

      - name: Build, tag, and push image to Amazon ECR
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          ECR_REPOSITORY: my-ai-backend # âš ï¸æ”¹æˆä½ çš„ ECR ä»“åº“å
          IMAGE_TAG: latest
        run: |
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG

      - name: Update Lambda function
        env:
          LAMBDA_FUNCTION_NAME: ai-backend-api # âš ï¸æ”¹æˆä½ çš„ Lambda å‡½æ•°å
        run: |
          aws lambda update-function-code --function-name $LAMBDA_FUNCTION_NAME --image-uri ${{ steps.login-ecr.outputs.registry }}/$ECR_REPOSITORY:latest
```

---

### æ€»ç»“ï¼šå¦‚ä½•ç¡®è®¤åŒæ­¥æ›´æ–°ï¼Ÿ

1.  **å‰ç«¯ï¼š** åªè¦ Push ä»£ç ï¼Œå» Amplify æ§åˆ¶å°çœ‹ Build çŠ¶æ€å˜ç»¿ï¼Œæˆ–è€…ç›´æ¥åˆ·æ–°ç½‘é¡µçœ‹æ•ˆæœã€‚
2.  **åç«¯ï¼š**
    *   **æ‰‹åŠ¨æµï¼š** å¿…é¡»ç¡®ä¿ä½ æ‰§è¡Œäº† `docker push` å¹¶ä¸”åœ¨ Lambda æ§åˆ¶å°ç‚¹äº† `Deploy new image`ã€‚
    *   **è‡ªåŠ¨æµ (GitHub Actions)ï¼š** Push åï¼Œå» GitHub ä»“åº“çš„ **Actions** æ ‡ç­¾é¡µï¼Œçœ‹é‚£ä¸ªåœ†åœˆæ˜¯ä¸æ˜¯å˜ç»¿äº†ã€‚å˜ç»¿å°±ä»£è¡¨ AWS åç«¯å·²ç»æ›´æ–°å®Œæ¯•ã€‚

**å»ºè®®ï¼š** æ—¢ç„¶æ˜¯ MVPï¼Œå…ˆæ‰‹åŠ¨æ›´å‡ æ¬¡åç«¯æ‰¾æ‰¾æ„Ÿè§‰ã€‚ç­‰è§‰å¾—çƒ¦äº†ï¼Œå†æŠŠä¸Šé¢çš„ GitHub Actions åŠ ä¸Šå»ã€‚äº«å—ä½ çš„å¼€å‘ä¹‹æ—…å§ï¼